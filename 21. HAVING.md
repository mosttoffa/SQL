## HAVING
тЬЕ <B>HAVING </b> <BR>  HAVING is like WHERE but operates on grouped records. HAVING requires that a GROUP BY clause is present. Groups that meet the HAVING criteria will be returned. HAVING is used with aggregrates: COUNT, MAX, SUM, etc. <br> 
HAVING clause рж╕рж╛ржзрж╛рж░ржгржд GROUP BY ржЫрж╛рзЬрж╛ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ ржпрж╛рзЯ ржирж╛, ржХрж╛рж░ржг ржПрж░ ржорзВрж▓ ржХрж╛ржЬ рж╣рж▓рзЛ group ржХрж░рж╛ data-рж░ ржЙржкрж░ filtering ржХрж░рж╛ тАФ ржЕрж░рзНржерж╛рзО aggregate result (ржпрзЗржоржи: SUM(), COUNT(), AVG() ржЗрждрзНржпрж╛ржжрж┐)-ржПрж░ ржнрж┐рждрзНрждрж┐рждрзЗ filter ржХрж░рж╛ред 
рждржмрзЗ ржХрж┐ржЫрзБ ржХрзНрж╖рзЗрждрзНрж░рзЗ, HAVING GROUP BY ржЫрж╛рзЬрж╛ use ржХрж░рж╛ technically possible, ржХрж┐ржирзНрждрзБ рж╕рзЗржЯрж╛ рждржЦржиржЗ рж╕ржорзНржнржм ржпржЦржи query рждрзЗ aggregate function ржерж╛ржХрзЗред HAVING = WHERE ржПрж░ ржорждрзЛ, ржХрж┐ржирзНрждрзБ aggregate data filter ржХрж░рж╛рж░ ржЬржирзНржпред рждрж╛ржЗ HAVING рж╕рж╛ржзрж╛рж░ржгржд GROUP BY ржПрж░ ржкрж░рзЗ ржерж╛ржХрзЗред <br> 

ЁЯФ╖ <b>HAVING vs WHERE тАФ Clear Difference </b> 
<pre>
	ржмрж┐рж╖рзЯ				| WHERE								| HAVING
	----------------------------------------------------------------------------------------------------
	Apply рж╣рзЯ			| Raw rows ржПрж░ ржЙржкрж░					| Aggregated (GROUPed) rows ржПрж░ ржЙржкрж░
	Aggregate functions	| тЭМ Use ржХрж░рж╛ ржпрж╛рзЯ ржирж╛				| тЬЕ Use ржХрж░рж╛ ржпрж╛рзЯ
	Execution Order		| Before GROUP BY					| After GROUP BY
	Purpose				| Filter raw data before grouping	| Filter summary data after grouping
</pre>
ЁЯСЙ Example: 
<pre>
-- WHERE filters before grouping
SELECT Country, COUNT(*) AS Total
FROM Customer
WHERE Country IS NOT NULL
GROUP BY Country
HAVING COUNT(*) > 10;   -- HAVING filters group result
</pre>

ЁЯФ╖ <b> HAVING Without GROUP BY </b> <br> 
рждрж╛рждрзНрждрзНржмрж┐ржХржнрж╛ржмрзЗ HAVING clause GROUP BY ржЫрж╛рзЬрж╛ржУ use ржХрж░рж╛ ржпрж╛рзЯ,ржпржЦржи ржкрзБрж░рзЛ ржЯрзЗржмрж┐рж▓ржЯрж╛ржЗ ржПржХржЯрж╛ржЗ group рж╣рж┐рж╕рзЗржмрзЗ ржзрж░рж╛ рж╣рзЯред
 Example: 
 <pre>
SELECT SUM(Sales) AS TotalSales
FROM Orders
HAVING SUM(Sales) > 100000;
 -- ржПржЦрж╛ржирзЗ HAVING act ржХрж░ржЫрзЗ aggregate filter рж╣рж┐рж╕рзЗржмрзЗ, ржпржжрж┐ржУ ржХрзЛржирзЛ group ржирзЗржЗред
 </pre>
 
ЁЯФ╖ <b>HAVING with Multiple Aggregate Conditions </b> <br> 
HAVING-ржП ржПржХрж╛ржзрж┐ржХ aggregate ржПржХрж╕рж╛ржерзЗ filter ржХрж░рж╛ ржпрж╛рзЯред
<pre>
	SELECT CustomerId,
       SUM(TotalAmount) AS Total,
       AVG(TotalAmount) AS AvgOrder
FROM Orders
GROUP BY CustomerId
HAVING SUM(TotalAmount) > 10000
   AND AVG(TotalAmount) > 500;
-- Useful when you need to apply multiple performance-based filters.
</pre>
ЁЯФ╖ <b>HAVING with Logical Operators </b>  <br> 
HAVING clause supports AND, OR, IN, BETWEEN, LIKE ржЗрждрзНржпрж╛ржжрж┐ред
<pre>
	SELECT Country, COUNT(*) AS TotalCustomers
FROM Customer
GROUP BY Country
HAVING Country LIKE 'U%' OR COUNT(*) > 20;
</pre>
ЁЯФ╖ <b>HAVING with CASE WHEN (Conditional Aggregation) </b> <br>
When you want grouped condition-based filtering, HAVING becomes powerful. 
<pre>
SELECT 
    Country,
    SUM(CASE WHEN Gender = 'Male' THEN 1 ELSE 0 END) AS TotalMale,
    SUM(CASE WHEN Gender = 'Female' THEN 1 ELSE 0 END) AS TotalFemale
FROM Customer
GROUP BY Country
HAVING SUM(CASE WHEN Gender = 'Female' THEN 1 ELSE 0 END) > 10;
</pre>

ЁЯФ╖ <b>HAVING with Subquery</b> <br> 
HAVING clause-ржП subquery use ржХрж░рзЗ dynamic filtering ржХрж░рж╛ ржпрж╛рзЯред
<pre>
SELECT CustomerId, SUM(TotalAmount) AS Total
FROM Orders
GROUP BY CustomerId
HAVING SUM(TotalAmount) > (
    SELECT AVG(TotalAmount) FROM Orders
);
-- ржПржЦрж╛ржирзЗ average ржПрж░ ржЙржкрж░ ржнрж┐рждрзНрждрж┐ ржХрж░рзЗ filtered grouping ржХрж░рж╛ рж╣ржЪрзНржЫрзЗред
</pre>
ЁЯФ╖ <b>HAVING in Real Life: </b> <br> 
ЁЯСЙ Example : Sales Target Report
<pre>
SELECT Region, SUM(SalesAmount) AS TotalSales
FROM Sales
GROUP BY Region
HAVING SUM(SalesAmount) >= 1000000;
-- ржкрзНрж░рждрж┐ржЯрж┐ Region ржпрж╛рж░ sales рззрзж рж▓ржХрзНрж╖рзЗрж░ ржмрзЗрж╢рж┐, рж╢рзБржзрзБ рждрж╛ржжрзЗрж░ ржжрзЗржЦрж╛ржмрзЗред
</pre>
ЁЯСЙ Example : Product Performance Analysis
<pre>
SELECT ProductId, COUNT(*) AS Orders, AVG(Price) AS AvgPrice
FROM OrderDetails
GROUP BY ProductId
HAVING COUNT(*) > 50 AND AVG(Price) BETWEEN 500 AND 1000;
-- рж╢рзБржзрзБржорж╛рждрзНрж░ ржпрзЗрж╕ржм ржкрзНрж░рзЛржбрж╛ржХрзНржЯрзЗрж░ demand ржмрзЗрж╢рж┐ ржУ average price ржорж╛ржЭрж╛рж░рж┐, рждрж╛ржжрзЗрж░ filter ржХрж░ржЫрзЗред
</pre>
ЁЯФ╖ <b>HAVING with CTE (Clean Analytics Query)</b> <br> 
CTE use ржХрж░рж▓рзЗ complex HAVING condition рж╕рж╣ржЬрзЗ manage ржХрж░рж╛ ржпрж╛рзЯред
<pre>
WITH SalesSummary AS (
    SELECT SalesPersonId, SUM(SalesAmount) AS TotalSales
    FROM Sales
    GROUP BY SalesPersonId
)
SELECT * FROM SalesSummary
HAVING TotalSales > 50000;
-- Readability + Reusability ржжрзБржЗ-ржЗ ржмрж╛рзЬрзЗред 
</pre>
ЁЯФ╖ <b>HAVING and NULL Handling </b> <br>
HAVING clause NULL value consider ржХрж░рзЗ ржирж╛ in aggregation. ржпржжрж┐ aggregate field-ржП NULL ржерж╛ржХрзЗ, рж╕рзЗржЯрж╛ skip рж╣рзЯ unless handled by ISNULL() or COALESCE().
<pre>
	HAVING SUM(ISNULL(Sales,0)) > 0
</pre>

ЁЯФ╖ <b>HAVING Performance Tips </b> 
 * Filtering large datasets : Use WHERE before grouping to reduce rows.
 * Aggregation cost : Pre-aggregate using CTE or Temp table
 * HAVING on non-aggregate : Move that condition to WHERE
<pre>
	-- Bad
HAVING Country = 'USA' AND SUM(Sales) > 5000
-- Better
WHERE Country = 'USA'
HAVING SUM(Sales) > 5000
</pre>
 
ЁЯФ╖ <b>HAVING with COUNT </b> <br> 
ЁЯСЙ Example:  List the number of customers in each country. Only include countries with more than 10 customers. 
<pre>SELECT Country, COUNT(Id) 'Total Customer'
		FROM Customer
		GROUP BY Country 
		HAVING COUNT(Id) > 10    </pre>		
ЁЯФ╖ <b>HAVING and ORDER BY </b>  <br> 
ЁЯСЙ Example: List the number of customers in each country, except the USA, sorted high to low. Only include countries with 9 or more customers. 
<pre>SELECT Country, COUNT(Id)'Total Customers'
		FROM Customer 
		WHERE Country <> 'USA'
		GROUP BY Country
		HAVING COUNT(Id) > 9 
		ORDER BY COUNT(Id) DESC   </pre>		
ЁЯФ╖<b>HAVING with AVG BETWEEN </b> <br> 
ЁЯСЙ Example: List customer with average orders between $1000 and $1200. 
<pre>SELECT C.FirstName, C.LastName, CONVERT(DECIMAL(10,2), AVG(O.TotalAmount))'Average Order'
		FROM [Order] O
		INNER JOIN Customer C ON O.CustomerId=C.Id
		GROUP BY C.FirstName, C.LastName
		HAVING AVG(O.TotalAmount) BETWEEN 1000 AND 1200    </pre>		 







